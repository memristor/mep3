<root main_tree_to_execute="BehaviorTree">
    <!-- ////////// -->
    <BehaviorTree ID="BehaviorTree">
        <SequenceStar>
            <SetBlackboard output_key="right_base_position" value="-90" />

            <DefaultTeamColorCondition default_color="purple" />
            <ScoreboardTask points="2" task="install_statuette_on_pedestal" />
            <WaitMatchStart state="1" />
            <WaitMatchStart state="2" />
            <Wait duration="1.0" />
            <TaskSequence>
                <SubTree ID="skill_compressed_pose" __shared_blackboard="true" />
                <SubTree ID="skill_neutral_pose" __shared_blackboard="true" />
                <SubTree ID="skill_lower_left_hand" __shared_blackboard="true" />
                <!-- <SubTree ID="task_move_green_sample" __shared_blackboard="true" />
                <SubTree ID="task_replica_and_statuette" __shared_blackboard="true" />
                <Control ID="IfTeamColorThenElseControl" color="purple">
                    <SubTree ID="task_excavation_squares" __shared_blackboard="true" />
                </Control> -->
            </TaskSequence>
        </SequenceStar>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="skill_retract_hands">
        <Parallel failure_threshold="1" success_threshold="1">
            <Dynamixel label="arm_right_motor_base" position="0" />
            <Dynamixel label="arm_right_motor_mid" position="-2" />
            <Dynamixel label="arm_right_motor_gripper" position="93" />
            <Dynamixel label="arm_right_motor_base" position="0" />
            <Dynamixel label="arm_right_motor_mid" position="-2" />
            <Dynamixel label="arm_right_motor_gripper" position="93" />
        </Parallel>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="skill_compressed_pose">
        <Sequence>
            <Parallel failure_threshold="1" success_threshold="6">
                <Dynamixel label="arm_left_motor_base" position="90" />
                <Dynamixel label="arm_right_motor_base" position="-90" />
                <Dynamixel label="arm_left_motor_mid" position="-25" />
                <Dynamixel label="arm_right_motor_mid" position="-25" />
                <Dynamixel label="arm_left_motor_gripper" position="-15" />
                <Dynamixel label="arm_right_motor_gripper" position="-15" />
            </Parallel>
        </Sequence>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="skill_neutral_pose">
        <Sequence>
            <Parallel failure_threshold="1" success_threshold="6">
                <Dynamixel label="arm_left_motor_base" position="90" />
                <Dynamixel label="arm_right_motor_base" position="-90" />
                <Dynamixel label="arm_left_motor_mid" position="-10" />
                <Dynamixel label="arm_right_motor_mid" position="-10" />
                <Dynamixel label="arm_left_motor_gripper" position="-15" />
                <Dynamixel label="arm_right_motor_gripper" position="-15" />
            </Parallel>
        </Sequence>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="skill_lower_left_hand">
        <Sequence>
            <Parallel failure_threshold="1" success_threshold="3">
                <Dynamixel label="arm_left_motor_base" position="90" />
                <Dynamixel label="arm_left_motor_mid" position="115" />
                <Dynamixel label="arm_left_motor_gripper" position="-55" />
            </Parallel>
        </Sequence>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="skill_swap">
        <Sequence>
            <Parallel failure_threshold="1" success_threshold="3">
                <Dynamixel label="arm_right_motor_base" position="0" />
                <Dynamixel label="arm_right_motor_mid" position="-2" />
                <Dynamixel label="arm_right_motor_gripper" position="93" />
            </Parallel>
            <Parallel failure_threshold="1" success_threshold="3">
                <Dynamixel label="arm_left_motor_base" position="0" />
                <Dynamixel label="arm_left_motor_mid" position="-3" />
                <Dynamixel label="arm_left_motor_gripper" position="91" />
            </Parallel>
            <VacuumPump label="arm_left_connector" connect="1" />
            <VacuumPump label="arm_right_connector" connect="0" />
            <Parallel failure_threshold="1" success_threshold="2">
                <Dynamixel label="arm_left_motor_base" position="90" />
                <Dynamixel label="arm_right_motor_base" position="-90" />
            </Parallel>
        </Sequence>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="test_pick_and_swap">
        <Sequence>
            <Parallel failure_threshold="1" success_threshold="7">
                <Dynamixel label="arm_right_motor_base" velocity="270" position="-90" tolerance="8" />
                <Dynamixel label="arm_right_motor_mid" velocity="270" position="100" tolerance="8" />
                <Dynamixel label="arm_right_motor_gripper" velocity="270" position="50" tolerance="8" />
                <VacuumPump label="arm_right_connector" connect="1" />
                <Dynamixel label="arm_left_motor_base" position="0" />
                <Dynamixel label="arm_left_motor_mid" position="-48" tolerance="5" />
                <Dynamixel label="arm_left_motor_gripper" position="60" />
            </Parallel>
            <Dynamixel label="arm_right_motor_mid" position="0" />
            <Parallel failure_threshold="1" success_threshold="3">
                <Dynamixel label="arm_right_motor_base" position="0" />
                <Dynamixel label="arm_right_motor_mid" position="-2" />
                <Dynamixel label="arm_right_motor_gripper" position="50" />
            </Parallel>
            <Parallel failure_threshold="1" success_threshold="3">
                <Dynamixel label="arm_left_motor_base" position="0" />
                <Dynamixel label="arm_left_motor_mid" position="05" tolerance="8" />
                <Dynamixel label="arm_left_motor_gripper" position="60" />
            </Parallel>
            <VacuumPump label="arm_left_connector" connect="1" />
            <VacuumPump label="arm_right_connector" connect="0" />
            <Parallel failure_threshold="1" success_threshold="2">
                <Dynamixel label="arm_left_motor_base" position="90" />
                <Dynamixel label="arm_right_motor_base" position="-90" />
            </Parallel>
        </Sequence>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="task_excavation_squares">
        <Sequence>
            <SubTree ID="skill_retract_hands" __shared_blackboard="true" />
            <PreciseNavigate goal="0.80;-0.805;180" />
            <Dynamixel label="hand_left_Dz" position="-70" />
            <ResistanceMeter label="left" resistance="470" tolerance="10.5" />
            <Parallel failure_threshold="1" success_threshold="2">
                <Dynamixel label="hand_left_Dz" position="0" />
                <PreciseNavigate goal="0.612;-0.805;180" />
            </Parallel>
            <Dynamixel label="hand_left_Dz" position="-70" />
            <ResistanceMeter label="left" resistance="470" tolerance="10.5" />
            <Parallel failure_threshold="1" success_threshold="2">
                <Dynamixel label="hand_left_Dz" position="0" />
                <PreciseNavigate goal="0.43;-0.805;180" />
            </Parallel>
            <Dynamixel label="hand_left_Dz" position="-70" />
            <ResistanceMeter label="left" resistance="4700" tolerance="10.5" />
            <Parallel failure_threshold="1" success_threshold="2">
                <Dynamixel label="hand_left_Dz" position="0" />
                <PreciseNavigate goal="0.246;-0.805;180" />
            </Parallel>
            <Dynamixel label="hand_left_Dz" position="-70" />
            <ResistanceMeter label="left" resistance="470" tolerance="10.5" />
            <Dynamixel label="hand_left_Dz" position="0" />
            <Navigate goal="0;0;1.5708" />
        </Sequence>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="task_move_green_sample">
        <Sequence>
            <Navigate goal="0.8;0.23;180" />
            <Parallel failure_threshold="1" success_threshold="3">
                <Dynamixel label="arm_right_motor_base" position="{right_base_position}" />
                <Dynamixel label="arm_right_motor_mid" position="100" />
                <Dynamixel label="arm_right_motor_gripper" position="80" />
            </Parallel>
            <VacuumPump label="arm_right_connector" connect="1" />
            <Dynamixel label="arm_right_motor_mid" position="0" />
            <Parallel failure_threshold="1" success_threshold="2">
                <SubTree ID="skill_swap" __shared_blackboard="true" />
                <PreciseNavigate goal="1.13;0.138;0" />
            </Parallel>
            <Dynamixel label="arm_left_motor_gripper" position="90" />
            <Dynamixel label="arm_left_motor_mid" position="90" />
            <VacuumPump label="arm_left_connector" connect="0" />
            <Dynamixel label="arm_left_motor_mid" position="0" />
            <ScoreboardTask points="1" task="store_green_sample_to_camp" />
        </Sequence>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="task_replica_and_statuette">
        <Sequence>
            <SubTree ID="skill_retract_hands" __shared_blackboard="true" />
            <Navigate goal="0.958108;-0.457233;135" />
            <PreciseNavigate goal="1.157;-0.675;135" behavior_tree="backward" />
            <Dynamixel label="hand_mid_L" position="90" timeout="2" />
            <ScoreboardTask points="5" task="remove_statuette_from_pedestal" />
            <ScoreboardTask points="10" task="install_replica_on_pedestal" />
            <Motion command="forward" value="0.3" />
            <Navigate goal="1.25;0.7;-90" />
            <PreciseNavigate goal="1.25;0.9;-90" behavior_tree="backward" />
            <Dynamixel label="hand_mid_L" position="-15" timeout="2" />
            <ScoreboardTask points="15" task="install_statuette_on_display_cabinet" />
            <Motion command="forward" value="0.7" />
        </Sequence>
    </BehaviorTree>
    <!-- ////////// -->
    <TreeNodesModel>
        <Condition ID="DefaultTeamColorCondition">
            <input_port name="default_color" default="purple">purple, yellow</input_port>
        </Condition>
        <Action ID="Dynamixel">
            <input_port name="position" default="0">[deg]</input_port>
            <output_port name="result">0 - success, 1 - timeout, 2 - other error</output_port>
            <input_port name="label" default="arm_left_motor_base">Motor name</input_port>
            <input_port name="timeout" default="5">[s]</input_port>
            <input_port name="tolerance" default="2">[deg]</input_port>
            <input_port name="velocity" default="90">[deg/s]</input_port>
        </Action>
        <Control ID="IfTeamColorThenElseControl">
            <input_port name="color" default="purple">purple, yellow</input_port>
        </Control>
        <Action ID="Lift">
            <input_port name="height" default="0">[cm]</input_port>
            <output_port name="result">0 - success, 1 - timeout, 2 - other error</output_port>
            <input_port name="label" default="lift_motor">Motor name</input_port>
            <input_port name="timeout" default="5">[s]</input_port>
            <input_port name="tolerance" default="0.5">[cm]</input_port>
            <input_port name="velocity" default="8">[cm/s]</input_port>
        </Action>
        <Action ID="Motion">
            <input_port name="acceleration_angular" default="0">[rad/s^2]</input_port>
            <input_port name="acceleration_linear" default="0">[m/s^2]</input_port>
            <input_port name="command">[forward/rotate_relative/rotate_absolute]</input_port>
            <output_port name="result">[success/drift]</output_port>
            <input_port name="value" default="0">value to pass to motion function, in meters or radians</input_port>
            <input_port name="velocity_angular" default="0">[rad/s]</input_port>
            <input_port name="velocity_linear" default="0">[m/s]</input_port>
        </Action>
        <Action ID="Navigate">
            <input_port default="0;0;0" name="goal">A target pose in format "x;y;theta".</input_port>
            <input_port default="" name="behavior_tree">Behavior tree</input_port>
        </Action>
        <Action ID="PreciseNavigate">
            <input_port default="0;0;0" name="goal">A target pose in format "x;y;theta".</input_port>
            <input_port default="backward" name="behavior_tree">Behavior tree (can be "backward" or "")</input_port>
        </Action>
        <Action ID="ResistanceMeter">
            <input_port name="resistance" default="1000">[Ohms]</input_port>
            <input_port name="label" default="left">Sensor name</input_port>
            <input_port name="tolerance" default="10">[%]</input_port>
        </Action>
        <Action ID="ScoreboardTask">
            <input_port name="points" default="0">points scored, can be negative</input_port>
            <input_port name="task" default="store_sample_to_work_shed">unique task name</input_port>
        </Action>
        <Action ID="Wait">
            <input_port name="duration" default="0.1">Delay in seconds</input_port>
        </Action>
        <Control ID="TaskSequence" />
        <Action ID="VacuumPump">
            <input_port name="connect" default="0">0 - disconnect, 1 - connected</input_port>
            <output_port name="result">0 - disconnected, 1 - connected, 2 - couldn't disconnect, 3 - couldn't connect, 4 - other</output_port>
            <input_port name="label" label="arm_left_connector">Pump name</input_port>
        </Action>
        <Action ID="WaitMatchStart">
            <input_port name="state" default="2">0 = unarmed; 1 = armed; 2 = started</input_port>
        </Action>
        <SubTree ID="skill_retract_hands">
            <input_port name="__shared_blackboard" default="true" />
        </SubTree>
        <SubTree ID="skill_swap">
            <input_port name="__shared_blackboard" default="true" />
        </SubTree>
        <SubTree ID="task_excavation_squares">
            <input_port name="__shared_blackboard" />
        </SubTree>
        <SubTree ID="task_move_green_sample">
            <input_port name="__shared_blackboard" />
        </SubTree>
        <SubTree ID="task_replica_and_statuette">
            <input_port name="__shared_blackboard" />
        </SubTree>
    </TreeNodesModel>
    <!-- ////////// -->
</root>
