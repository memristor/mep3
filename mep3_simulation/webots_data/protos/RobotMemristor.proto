#VRML_SIM R2021b utf8
# template language: javascript

PROTO RobotMemristor [
  field SFString   name              "test_robot"
  field SFVec3f    translation       0 0 0.05
  field SFRotation rotation          0 1 0 0
  field SFString   controller        "test_robot"
  field SFFloat    mass_robot        2
  field SFFloat    mass_motor_wheel    0.05
  field SFFloat    mass_encoder_wheel  0.05
  field SFFloat    mass_arm_base     0.2
  field SFFloat    mass_arm_mid1     0.15
  field SFFloat    mass_arm_mid2     0.3
  field SFFloat    mass_arm_gripper  0.1
  hiddenField SFFloat motor_wheel_radius 0.036
  hiddenField SFFloat motor_wheel_height 0.035
  hiddenField SFFloat motor_wheel_distance 0.143
  hiddenField SFFloat encoder_wheel_radius 0.0375
  hiddenField SFFloat encoder_wheel_height 0.007
  hiddenField SFFloat encoder_wheel_distance 0.287
  hiddenField SFFloat arm_x 0.075
  hiddenField SFFloat arm_y 0.132
  hiddenField SFFloat arm_z 0.063
  hiddenField SFFloat robot_x_size 0.2
  hiddenField SFFloat robot_y_size 0.3
  hiddenField SFFloat robot_z_size 0.34
]
{
Robot {
  translation IS translation
  rotation IS rotation
  name IS name
  controller IS controller
  children [
    Shape {
      appearance DEF ROBOT_APPEARANCE PBRAppearance {
        baseColor 0.631 0.612 0.537
        roughness 1
        metalness 0
      }
      geometry Mesh {
        url ["assets/meshes/robot/Robot.obj"]
      }
    }
    Transform {
      translation 0 %<= fields.motor_wheel_distance.value/2 >% %<= fields.motor_wheel_radius.value >%
      children [
        HingeJoint {
          jointParameters HingeJointParameters {
            axis 0 1 0
          }
          device [
            RotationalMotor {
              name %<= '"' + fields.name.value + '_wheel_left' + '"' >%
              maxTorque 100
            }
          ]
          endPoint Solid {
            name %<= '"' + fields.name.value + '_wheel_left_solid' + '"' >%
            boundingObject DEF MOTOR_WHEEL_BO Cylinder {
              height IS motor_wheel_height
              radius IS motor_wheel_radius
            }
            physics Physics {
              density -1
              mass IS mass_motor_wheel
            }
          }
        }
      ]
    }
    Transform {
      translation 0 %<= -fields.motor_wheel_distance.value/2 >% %<= fields.motor_wheel_radius.value >%
      children [
        HingeJoint {
          jointParameters HingeJointParameters {
            axis 0 1 0
          }
          device [
            RotationalMotor {
              name %<= '"' + fields.name.value + '_wheel_right' + '"' >%
              maxTorque 100
            }
          ]
          endPoint Solid {
            name %<= '"' + fields.name.value + '_wheel_right_solid' + '"' >%
            boundingObject USE MOTOR_WHEEL_BO 
            physics Physics {
              density -1
              mass IS mass_motor_wheel
            }
          }
        }
      ]
    }
    Transform {
      translation 0 %<= -fields.encoder_wheel_distance.value/2 >% %<= fields.encoder_wheel_radius.value >%
      children [
        HingeJoint {
          jointParameters HingeJointParameters {
            axis 0 1 0
          }
          device [
            PositionSensor {
              name %<= '"' + fields.name.value + '_encoder_right' + '"' >%
            }
          ]
          endPoint Solid {
            name %<= '"' + fields.name.value + '_encoder_right_solid' + '"' >%
            boundingObject DEF ENCODER_WHEEL_BO Cylinder {
              height IS encoder_wheel_height
              radius IS encoder_wheel_radius
            }
            physics Physics {
              density -1
              mass IS mass_encoder_wheel
            }
          }
        }
      ]
    }
    Transform {
      translation 0 %<= fields.encoder_wheel_distance.value/2 >% %<= fields.encoder_wheel_radius.value >%
      children [
        HingeJoint {
          jointParameters HingeJointParameters {
            axis 0 1 0
          }
          device [
            PositionSensor {
              name %<= '"' + fields.name.value + '_encoder_left' + '"' >%
            }
          ]
          endPoint Solid {
            name %<= '"' + fields.name.value + '_encoder_left_solid' + '"' >%
            children [
              Shape {
                appearance USE ROBOT_APPEARANCE
                geometry Cylinder {
                  height IS encoder_wheel_height
                  radius IS encoder_wheel_radius
                }
              }
            ]
            boundingObject USE ENCODER_WHEEL_BO
            physics Physics {
              density -1
              mass IS mass_encoder_wheel
            }
          }
        }
      ]
    }
    RobotArmMemristor {
      name %<= '"' + fields.name.value + '_arm_right' + '"' >%
      translation %<= fields.arm_x.value >% %<= -fields.arm_y.value >% %<= fields.arm_z.value >%
      rotation 0 0 1 1.5708
      mass_base IS mass_arm_base
      mass_mid1 IS mass_arm_mid1
      mass_mid2 IS mass_arm_mid2
      mass_gripper IS mass_arm_gripper
    }
    RobotArmMemristor {
      name %<= '"' + fields.name.value + '_arm_left' + '"' >%
      translation %<= fields.arm_x.value >% %<= fields.arm_y.value >% %<= fields.arm_z.value >%
      rotation 0 0 1 -1.5708
      mass_base IS mass_arm_base
      mass_mid1 IS mass_arm_mid1
      mass_mid2 IS mass_arm_mid2
      mass_gripper IS mass_arm_gripper
    }
  ]
  boundingObject Transform {
    translation 0 0 %<= fields.robot_z_size.value/2 + 0.0001 >%
    children [
      Box {
        size %<= fields.robot_x_size.value >% %<= fields.robot_y_size.value >% %<= fields.robot_z_size.value >%
      }
    ]
  }
  physics Physics {
    density -1
    mass IS mass_robot
  }
}
}
