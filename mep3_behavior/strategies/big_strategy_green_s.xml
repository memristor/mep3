<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="4">
  <BehaviorTree ID="big_strategy_green_s">
    <Sequence>
      <ForceSuccess>
        <Sequence _onSuccess="pokupio_prvi := 1"
                  _onFailure="pokupio_prvi := 0">
          <SubTree ID="detection"
                   color="{color}"
                   goal="-0.25;-0.47;0"
                   node="{node}"
                   table="{table}"/>
          <Translate goal="0.055"
                     ignore_obstacles="true"
                     max_velocity="0.4"
                     max_acceleration="0.1"/>
          <JointPosition instance="m1"
                         max_effort="0"
                         max_velocity="50"
                         position="112"
                         tolerance="10"
                         feedback_effort="feedback_effort"
                         feedback_position="feedback_position"
                         result="result"/>
          <SubTree ID="skill_lift_cake_right"
                   color="{color}"
                   table="{table}"/>
        </Sequence>
      </ForceSuccess>
      <ForceSuccess>
        <Sequence>
          <SubTree ID="gentle_attack"
                   color="{color}"
                   goal="-0.3;-0.835;180"
                   node="{node}"
                   table="{table}"/>
          <Sequence>
            <Fallback>
              <Timeout msec="3000">
                <RetryUntilSuccessful num_attempts="6">
                  <Fallback>
                    <SubTree ID="move_x"
                             color="{color}"
                             goal="-0.63;-0.835;180"
                             node="{node}"
                             table="{table}"
                             velocity="1.3"/>
                    <Sequence>
                      <Wait duration="0.5"/>
                      <AlwaysFailure/>
                    </Sequence>
                  </Fallback>
                </RetryUntilSuccessful>
              </Timeout>
              <ForceFailure>
                <Translate goal="-0.15"
                           ignore_obstacles="false"
                           max_velocity="0.8"
                           max_acceleration="0.5"/>
              </ForceFailure>
            </Fallback>
            <Parallel failure_count="1"
                      success_count="-1">
              <JointPosition instance="m10"
                             max_effort="0"
                             max_velocity="200"
                             position="183"
                             tolerance="10"
                             feedback_effort="inner_feedback_effort"
                             feedback_position="inner_feedback_position"
                             result="inner_result"/>
              <JointPosition instance="m1"
                             max_effort="0"
                             max_velocity="200"
                             position="111"
                             tolerance="10"
                             feedback_effort="feedback_effort"
                             feedback_position="feedback_position"
                             result="result"/>
            </Parallel>
            <Translate goal="-0.35"
                       ignore_obstacles="false"
                       max_velocity="1.0"
                       max_acceleration="0.5"/>
          </Sequence>
        </Sequence>
      </ForceSuccess>
      <ForceSuccess>
        <Sequence>
          <SubTree ID="gentle_attack"
                   color="{color}"
                   goal="-0.24;-1.00; 90"
                   node="{node}"
                   table="{table}"/>
          <SubTree ID="detection"
                   color="{color}"
                   goal="-0.17;-1.20; 90"
                   node="{node}"
                   table="{table}"/>
          <Parallel failure_count="1"
                    success_count="-1">
            <JointPosition instance="m1"
                           max_effort="0"
                           max_velocity="200"
                           position="83"
                           tolerance="10"
                           feedback_effort="feedback_effort"
                           feedback_position="feedback_position"
                           result="result"/>
            <JointPosition instance="m10"
                           max_effort="0"
                           max_velocity="200"
                           position="210"
                           tolerance="10"
                           feedback_effort="feedback_effort"
                           feedback_position="feedback_position"
                           result="result"/>
            <JointPosition instance="m6"
                           max_effort="0"
                           max_velocity="200"
                           position="150"
                           tolerance="10"
                           feedback_effort="feedback_effort"
                           feedback_position="feedback_position"
                           result="result"/>
          </Parallel>
          <ScoreboardTask points="3"
                          task="cake_12"/>
          <ScoreboardTask points="3"
                          task="cake_12"/>
          <Sequence>
            <ForceSuccess>
              <Sequence>
                <SubTree ID="skill_put_cherry"
                         color="{color}"
                         table="{table}"
                         _autoremap="false"/>
                <ScoreboardTask points="3"
                                task="cherry_1"/>
              </Sequence>
            </ForceSuccess>
            <ForceSuccess>
              <Sequence>
                <SubTree ID="skill_put_one_cherry"
                         color="{color}"
                         table="{table}"/>
                <ScoreboardTask points="3"
                                task="cherry_6"/>
              </Sequence>
            </ForceSuccess>
            <JointPosition instance="m6"
                           max_effort="0"
                           max_velocity="220"
                           position="150"
                           tolerance="10"
                           feedback_effort="feedback_effort"
                           feedback_position="feedback_position"
                           result="result"/>
            <Sequence _skipIf="pokupio_prvi == 0">
              <Parallel failure_count="1"
                        success_count="-1">
                <SubTree ID="skill_pick_one_cherry"
                         color="{color}"
                         table="{table}"/>
                <Translate goal="-0.17"
                           ignore_obstacles="false"
                           max_velocity="1.0"
                           max_acceleration="0.5"/>
              </Parallel>
              <Parallel failure_count="1"
                        success_count="-1">
                <JointPosition instance="m6"
                               max_effort="0"
                               max_velocity="220"
                               position="150"
                               tolerance="10"
                               feedback_effort="feedback_effort"
                               feedback_position="feedback_position"
                               result="result"/>
                <SubTree ID="skill_drop_cake_right"
                         color="{color}"
                         table="{table}"/>
              </Parallel>
              <ForceSuccess>
                <Sequence>
                  <SubTree ID="skill_put_one_cherry"
                           color="{color}"
                           table="{table}"/>
                  <ScoreboardTask points="3"
                                  task="cherry_6"/>
                </Sequence>
              </ForceSuccess>
              <ScoreboardTask points="3"
                              task="cake_3"/>
            </Sequence>
            <JointPosition instance="m5"
                           max_effort=""
                           max_velocity="200"
                           position="280"
                           tolerance="10"
                           feedback_effort=""
                           feedback_position=""
                           result=""/>
            <JointPosition instance="m6"
                           max_effort="0"
                           max_velocity="220"
                           position="60"
                           tolerance="10"
                           feedback_effort="feedback_effort"
                           feedback_position="feedback_position"
                           result="result"/>
          </Sequence>
        </Sequence>
      </ForceSuccess>
      <ForceSuccess>
        <Translate goal="-0.25"
                   ignore_obstacles="false"
                   max_velocity="1.0"
                   max_acceleration="0.5"/>
      </ForceSuccess>
    </Sequence>
  </BehaviorTree>

  <!-- Description of Node Models (used by Groot) -->
  <TreeNodesModel>
    <Action ID="JointPosition"
            editable="true">
      <input_port name="instance"/>
      <input_port name="max_effort"
                  default="0"/>
      <input_port name="max_velocity"
                  default="180"/>
      <input_port name="position"/>
      <input_port name="tolerance"
                  default="10"/>
      <output_port name="feedback_effort"
                   default="feedback_effort"/>
      <output_port name="feedback_position"
                   default="feedback_position"/>
      <output_port name="result"
                   default="result"/>
    </Action>
    <Action ID="ScoreboardTask"
            editable="true">
      <input_port name="points"
                  default="0">points scored, can be negative</input_port>
      <input_port name="task"
                  default="store_sample_to_work_shed">unique task name</input_port>
    </Action>
    <Action ID="Translate"
            editable="true">
      <input_port name="goal"
                  default="0"/>
      <input_port name="ignore_obstacles"
                  default="false"/>
      <input_port name="max_velocity"
                  default="0.8"/>
      <inout_port name="max_acceleration"
                  default="0.5"/>
    </Action>
    <Action ID="Wait"
            editable="true">
      <input_port name="duration"/>
    </Action>
  </TreeNodesModel>

</root>
